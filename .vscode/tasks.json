{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "cmake",
            "type": "shell",
            "command": "cmake",
            "args": [
                "-B", "${workspaceFolder}/build",
                "-G", "Unix Makefiles",
                "-DCMAKE_EXPORT_COMPILE_COMMANDS=ON", 
            ],
            "options": { "cwd": "${workspaceFolder}" },
            "problemMatcher": [],
            "detail": "配置 STM32F407 CMake 构建系统并生成 compile_commands.json"
        },
        {
            "label": "build",
            "type": "shell",
            "command": "cmake",
            "args": [
                "--build", "${workspaceFolder}/build",
                "-j", "8"
            ],
            "options": { "cwd": "${workspaceFolder}" },
            "group": { "kind": "build", "isDefault": true },
            "dependsOn": ["cmake"],
            "problemMatcher": [],
            "presentation": {
                "clear": true,
                "panel": "shared"
            },
            "detail": "编译 STM32 项目"
        },

        {
            "label": "flash",
            "type": "shell",
            "command": "openocd",
            "args": [
                "-s", "/usr/share/openocd/scripts",
                "-f", "interface/stlink-v2.cfg",
                "-f", "target/stm32f4x.cfg",
                "-c", "program ${workspaceFolder}/build/Test.elf verify reset exit"
            ],
            "options": { "cwd": "${workspaceFolder}" },
            "dependsOn": ["build"],
            "problemMatcher": [],
            "presentation": { "clear": true, "panel": "shared" },
            "detail": "将程序烧录到 STM32 芯片"
        },
        {
            "label": "openocd",
            "type": "shell",
            "command": "openocd",
            "args": [
            "-f", "/usr/share/openocd/scripts/interface/stlink-v2.cfg",
            "-f", "/usr/share/openocd/scripts/target/stm32f4x.cfg"
            ],
            "options": {"cwd": "${workspaceFolder}"},
            "presentation": {"clear": true, "panel": "shared"},
            "detail": "启动 OpenOCD 服务器"
        },
        
        {
            "label": "clean",
            "type": "shell",
            "command": "rm",
            "args": ["-rf", "${workspaceFolder}/build"],
            "options": { "cwd": "${workspaceFolder}" },
            "problemMatcher": [],
            "detail": "删除 build 目录"
        },
        {
            "label": "rebuild",
            "type": "shell",
            "dependsOn": ["clean", "build"],
            "dependsOrder": "sequence",
            "problemMatcher": [],
            "detail": "清空并重新编译"
        },
    ]
}
